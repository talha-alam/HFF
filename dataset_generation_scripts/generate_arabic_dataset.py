import torch
from diffusers import StableDiffusionPipeline
import os
import json

# --- الإعدادات ---
# ينشئ هذا السكريبت مجموعة بيانات "آمنة" تتكون من مفاهيم
# بعيدة دلالياً عن مفهوم "العري".

# 1. تحديد النموذج الأساسي لتوليد الصور.
MODEL_ID = "runwayml/stable-diffusion-v1-5"

# 2. تحديد دليل الإخراج الرئيسي لمجموعة البيانات الآمنة الجديدة.
OUTPUT_DIR = "safe_finetuning_dataset_arabic"

# 3. تحديد الموجه السلبي لتجنب توليد المفهوم المستهدف.
NEGATIVE_PROMPT = "عري، محتوى غير لائق، مكشوف، صريح، جنسي، عاري، بدون ملابس، بشرة"

# 4. تحديد ترتيب المنهج "الآمن".
CURRICULUM_ORDER = [
    "المخططات المعمارية",
    "السيارات العتيقة",
    "الأسماك الاستوائية",
    "المناظر الجبلية",
    "أشجار البونساي",
    "الحلويات الفاخرة",
    "الآلات الموسيقية",
    "أفق المدن ليلاً",
    "الطيور الغريبة",
    "الأنماط الهندسية المجردة",
]

# 5. مجموعة من الموجهات الآمنة بالعربية.
PROMPTS = {
    "المخططات المعمارية": [
        "رسم معماري مفصل لناطحة سحاب حديثة، منظر قطاعي",
        "مخطط تصميمي لمنزل سكني من طابقين مع الأبعاد",
        "مخطط معماري مرسوم باليد لجسر معلق",
        "رسم CAD لتخطيط صالة مطار",
        "مخطط لقبة كلاسيكية من كاتدرائية قديمة",
        "منظر ارتفاع معماري لواجهة مبنى مستقبلي",
        "مخطط مقطع عرضي يظهر أساس هيكل كبير",
        "مخطط لسلم حلزوني، منظر من الأعلى",
        "رسم تقني لنظام هيكل السقف",
        "مخطط لمنزل صغير بسيط مع التصميم الداخلي",
        "مخطط موقع معماري لحديقة عامة جديدة",
        "مخطط مفصل لمسرح ومنطقة المقاعد",
        "مخطط لتصميم أرضية مصنع صناعي",
        "مخطط سيانوتايب عتيق لقاطرة من القرن التاسع عشر",
        "عرض ثلاثي الأبعاد لمبنى معروض كمخطط إطار سلكي",
        "تفاصيل معمارية لإطار نافذة وقسم جدار",
        "مخطط لمنصة محطة مترو وأنفاق",
        "مخطط لمبنى أخضر مستدام مع ألواح شمسية",
        "مخطط أرضية لجناح فندق فاخر",
        "رسم تقني لهيكل قبة جيوديسية",
        "مخطط لمعرض فني حديث مع مساحات مفتوحة",
        "رسم معماري لمدينة عائمة مفاهيمية",
        "مخطط لأنظمة السباكة والكهرباء في المبنى",
        "مخطط لملعب رياضي مع مخطط المقاعد",
        "رسم ارتفاع لصف من المنازل الفيكتورية",
        "مخطط لتصميم منزل معياري مسبق الصنع",
        "مخطط معماري لحديقة زن يابانية",
        "رسم تقني لعمود مصعد وآليته",
        "مخطط لموقف سيارات متعدد الطوابق",
        "مخطط أرضية لمكتبة جامعية",
        "مخطط عتيق لمركب شراعي كلاسيكي",
        "عرض معماري لفيلا ساحلية، نمط مخطط",
        "مخطط مفصل لبيت زجاجي في حديقة نباتية",
        "مخطط لتخطيط غرفة خوادم كمبيوتر",
        "مخطط لاستوديو تسجيل مع غرف عازلة للصوت",
        "مقطع عرضي لسد، رسم تقني",
        "مخطط معماري لتصميم مطبخ حديث",
        "مخطط يظهر الهيكل الفولاذي لمبنى شاهق",
        "مخطط لتصميم ملعب أطفال",
        "رسم توضيحي تقني لتحصينات قلعة، مخطط",
        "مخطط لشرفة على السطح مع حديقة ومقاعد",
        "مخطط لداخل قمرة قيادة سفينة فضاء",
        "رسم معماري لقاعة رقص كبيرة",
        "مخطط لتصميم كرم ومصنع نبيذ",
        "مخطط لمختبر أبحاث",
        "رسم تقني لمحطة معالجة مياه",
        "مخطط معماري لرياض مغربي تقليدي",
        "مخطط لمنصة مراقبة على جبل",
        "مخطط لتصميم ديكور لمسرحية",
        "مخطط أرضية لمساحة مكتب مفتوحة"
    ],
    "السيارات العتيقة": [
        "سيارة شيفروليه بيل إير كلاسيكية من عام 1957 باللون الأحمر الكرزي، متوقفة بجوار مطعم",
        "سيارة فورد موديل A سوداء من الثلاثينيات على طريق ريفي مترب",
        "سيارة جاكوار إي-تايب أنيقة فضية من عام 1961 على طريق ساحلي متعرج",
        "سيارة فولكس فاجن بيتل من الستينيات، مطلية بالأزرق الباستيل مع حامل سقف",
        "سيارة فورد موستانج ماك 1 قوية من عام 1969 باللون الأصفر الساطع",
        "سيارة كاديلاك إلدورادو فاخرة من عام 1959 مع زعانف خلفية كبيرة",
        "لقطة مقربة لشبكة كروم لسيارة رولز رويس عتيقة",
        "شاحنة صغيرة صدئة قديمة من الأربعينيات في حظيرة",
        "سيارة فيراري تيستاروسا رياضية من عام 1985 باللون الأحمر الأيقوني",
        "سيارة ميني كوبر كلاسيكية من السبعينيات تتنقل في شارع أوروبي ضيق",
        "سيارة سباق بوجاتي تايب 35 من العشرينيات على مسار تاريخي",
        "سيارة مرسيدس بنز 300SL غولوينغ عتيقة مع أبوابها المفتوحة",
        "سيارة ديلاهاي 165 أنيقة من عام 1938 مع رفارف انسيابية",
        "سيارة عائلية بلوحات خشبية من الخمسينيات مجهزة لرحلة عائلية",
        "سيارة فورد برونكو قوية من عام 1972 في بيئة غابات",
        "سيارة فيات 500 صغيرة من الستينيات متوقفة في شارع مرصوف بالحصى في إيطاليا",
        "سيارة كورفيت ستينج راي من عام 1963 مع نافذتها الخلفية المنقسمة",
        "سيارة بورش 911 كلاسيكية من الثمانينيات، طراز مبرد بالهواء",
        "سيارة سيتروين DS عتيقة مع نظام تعليقها الهيدروبنوماتي الفريد",
        "سيارة تاكر 48 من عام 1948، معروفة بمصباحها الأمامي المركزي",
        "لقطة مقربة لعجلة ذات أسلاك شعاعية على سيارة رياضية بريطانية من الثلاثينيات",
        "صف من دراجات فيسبا العتيقة الملونة متوقفة في روما",
        "سيارة فورد ثندربيرد قابلة للتحويل من عام 1955 باللون الفيروزي",
        "سيارة لاند روفر ديفندر قديمة في مغامرة سفاري",
        "سيارة أوبورن بوتتيل سبيدستر جميلة من عام 1936",
        "سيارة ألفا روميو سبايدر قابلة للتحويل عتيقة من الستينيات",
        "سيارة عضلات أمريكية كلاسيكية، دودج تشارجر من عام 1970",
        "سيارة مفاهيمية ريترو-مستقبلية من الخمسينيات في معرض سيارات",
        "سيارة فولكس فاجن كارمان غيا من السبعينيات",
        "سيارة رياضية يابانية عتيقة، داتسون 240Z",
        "سيارة ديوسنبرغ موديل J من الثلاثينيات، رمز الفخامة",
        "شاحنة ركوب الأمواج الخشبية الكلاسيكية من الستينيات على الشاطئ",
        "سيارة مورغان ثلاثية العجلات من الثلاثينيات",
        "سيارة شرطة عتيقة من الخمسينيات",
        "سيارة أجرة نيويورك كلاسيكية صفراء من السبعينيات",
        "سيارة لينكولن كونتيننتال من الستينيات مع أبواب انتحارية",
        "سيارة أستون مارتن DB5 جميلة، سيارة الجاسوس الكلاسيكية",
        "سيارة صدئة مهجورة في بلدة أشباح صحراوية",
        "شاحنة إطفاء عتيقة من أوائل القرن العشرين",
        "سيارة فقاعة مسرشميت KR200 من الخمسينيات",
        "سيارة BMW 2002 كلاسيكية من السبعينيات",
        "سيارة أجرة تشيكر ماراثون عتيقة",
        "سيارة شيلبي كوبرا 427 قوية من الستينيات",
        "سيارة سيتروين 2CV فرنسية مع سقفها القماشي المطوي",
        "حافلة غراي هاوند كلاسيكية من الخمسينيات",
        "سيارة جيب ويليز من الأربعينيات من الحقبة العسكرية",
        "سيارة بنتلي عتيقة جميلة مع مبرد كروم كبير",
        "سيارة لامبورغيني كونتاش من الثمانينيات مع أبواب مقصية",
        "سيارة ساب 900 توربو كلاسيكية من الثمانينيات",
        "مقطورة إيرستريم عتيقة يتم سحبها بواسطة سيارة كلاسيكية"
    ],
    "الأسماك الاستوائية": [
        "سمكة المهرج النابضة بالحياة تسبح في شقائق النعمان البحرية",
        "سرب من أسماك التيترا النيون في حوض مياه عذبة",
        "سمكة الجراح الزرقاء المهيبة في الشعاب المرجانية",
        "سمكة الماندرين الملونة تُظهر أنماطها المعقدة",
        "سمكة الجراح الصفراء تتغذى على الطحالب",
        "سمكة الملاك الملكية ذات الخطوط الزرقاء والصفراء",
        "سمكة منتفخة في وضع الدفاع",
        "سمكة الأسد مع أشواكها السامة المنتشرة",
        "سمكة بيتا جميلة ذات زعانف طويلة ومتدفقة",
        "مجموعة من أسماك الديسكس في حوض مزروع",
        "حصان البحر متشبث بقطعة من المرجان",
        "سمكة المور الوثنية ذات الأشرطة السوداء والبيضاء والصفراء المميزة",
        "سمكة الملاك الإمبراطورية المذهلة، التلوين الشبابي والبالغ",
        "سمكة البوق الطويلة والنحيلة تختبئ بين سيقان البحر",
        "سمكة الصندوق ذات الشكل الفريد والمربع",
        "سمكة الببغاء الملونة تمضغ المرجان",
        "سمكة غوبي صغيرة تستريح على قاع رملي",
        "قنديل البحر الساحر ينبض في البحر الأزرق العميق",
        "شفنين مانتا المهيب ينزلق عبر المحيط",
        "شفنين نسر مرقط بالقرب من قاع المحيط",
        "سرب من أسماك الفراشة الصفراء اللامعة",
        "سمكة غوبي النار مع ألوانها الحمراء والبيضاء النابضة بالحياة",
        "ثعبان البحر الأخضر يطل من شق صخري",
        "سمكة الحجر الجميلة لكن المموهة",
        "سمكة الضفدع ذات المظهر الكاريكاتوري على قاع البحر",
        "سمكة الزناد مع شوكتها الظهرية الفريدة",
        "سمكة التاسك الهارلكوين تظهر أنيابها الزرقاء",
        "سرب من السردين اللامع يشكل كرة طعم",
        "سمكة الأنثياس في سرب كبير ملون",
        "سمكة الجراح الزرقاء البودرة في الشعاب المرجانية الساطعة",
        "سمكة الملف ذات الجلد الخشن مثل ورق الصنفرة",
        "سمكة الصقر جالسة على رأس مرجاني، تراقب الفريسة",
        "سمكة الكاردينال تطفو في كهف مظلم",
        "سمكة الراس تنظف سمكة أكبر في محطة تنظيف",
        "تنين البحر الورقي الجميل والنادر",
        "سمكة الفانوس مع عضوها المضيء بالإضاءة الحيوية",
        "سمكة البقرة مع قرونها البارزة",
        "الأخطبوط ذو الحلقات الزرقاء، جميل لكن مميت",
        "المحارة العملاقة مع غطائها الملون المكشوف",
        "دودة شجرة الكريسماس على رأس مرجاني",
        "نجم البحر متشبث بصخرة",
        "رخويات عارية ملونة تزحف على الشعاب المرجانية",
        "جمبري منظف يعمل على سمكة أكبر",
        "حصان بحر قزم صغير على مروحة بحرية",
        "سمكة الهامور المرجانية مع بقعها الحمراء والزرقاء الساطعة",
        "سمكة طائرة تقفز خارج الماء",
        "سمكة باراكودا مع أسنانها الحادة المرئية",
        "قرش الحوت يسبح بسلام بالقرب من السطح",
        "سمكة القمر، أو مولا مولا، بالقرب من السطح",
        "سرب من أسماك الملائكة في بحيرة صافية"
    ],
    "المناظر الجبلية": [
        "قمة جبل مهيبة مغطاة بالثلوج عند شروق الشمس",
        "وادٍ أخضر خصب محاط بجبال وعرة",
        "طريق جبلي متعرج في الخريف مع أشجار ملونة",
        "بحيرة جبلية هادئة تعكس القمم المحيطة",
        "متنزه منفرد على قمة جبلية يطل على منظر طبيعي شاسع",
        "الصورة الظلية الدرامية لسلسلة جبال عند الغروب",
        "شلال ينحدر من منحدر صخري جبلي",
        "كوخ ريفي من جذوع الأشجار في غابة جبلية",
        "سماء الليل المليئة بالنجوم فوق سلسلة جبال مظلمة",
        "الغيوم والضباب يتدحرجان عبر ممر جبلي",
        "جبل بركاني متعرج مع دخان يتصاعد من فوهته",
        "قمة ماترهورن في جبال الألب السويسرية",
        "منظر بانورامي لجبال الهيمالايا",
        "حقل ملون من الزهور البرية في مرج جبلي",
        "نهر جليدي يتحرك ببطء أسفل وادٍ جبلي",
        "ماعز جبلي متوازن على حافة منحدر خطر",
        "الشفق القطبي فوق منظر جبلي مثلج",
        "دير بوذي عالٍ في جبال التبت",
        "قطار يسافر على جسر سكة حديد جبلي مرتفع",
        "جراند كانيون مع تشكيلاته الصخرية الطبقية",
        "منظر صحراوي مع ميساس وبوتس في الخلفية",
        "غابة كثيفة من أشجار الصنوبر على منحدرات جبل",
        "طيار شراعي يحلق فوق سلسلة جبال",
        "التشكيلات الصخرية الفريدة لزانجياجياجي، الصين",
        "مزرعة تقليدية متدرجة على منحدر جبلي حاد",
        "جسر معلق يعبر خانق جبلي عميق",
        "التلال المتموجة لمرتفعات اسكتلندا",
        "عاصفة تتجمع فوق جبل مظلم ومهيب",
        "جدول جبلي مع مياه صافية تتدفق فوق أحجار ملساء",
        "جبل فوجي الشهير في اليابان مع أزهار الكرز في المقدمة",
        "منظر لجبال الأنديز من ماتشو بيتشو",
        "برج مراقبة وحيد على قمة جبلية",
        "متسلق صخور يتسلق وجه جبل حاد",
        "سلسلة جبال الدولوميت الدرامية في إيطاليا عند الغروب",
        "قوس قزح يظهر فوق وادٍ جبلي بعد عاصفة",
        "أطلال قلعة قديمة على قمة جبل",
        "الألوان النابضة بالحياة لجبال قوس قزح في بيرو",
        "تلفريك يصعد جبلًا حادًا",
        "حريق غابات على جانب جبل بعيد في الليل",
        "قطيع من الأغنام يرعى على منحدر جبلي أخضر",
        "راكب دراجة جبلية على مسار ضيق ومليء بالتحديات",
        "القمر يشرق فوق قمة جبل مظللة",
        "شلال متجمد على جبل في الشتاء",
        "المنظر من قمة جبل، فوق الغيوم",
        "كوخ تقليدي في جبال الألب مع زهور على الشرفة",
        "الظل الطويل لجبل يمتد عبر وادٍ",
        "نهر ينحت وادياً عبر سلسلة جبال",
        "قوس قزح مزدوج فوق منظر جبلي أخضر",
        "الأضواء الشمالية فوق جبل كيركجوفيل في أيسلندا",
        "مسار متعرج يؤدي إلى جبل عشبي"
    ],
    "أشجار البونساي": [
        "شجرة بونساي قيقب ياباني دقيقة بأوراق حمراء في الخريف",
        "شجرة بونساي عرعر قديمة ومعقودة في وعاء خزفي",
        "شجرة بونساي أزالية مزهرة بزهور وردية نابضة بالحياة",
        "شجرة بونساي على طراز الشلال تنمو على جانب وعائها",
        "بونساي على طراز الغابة مع أشجار صغيرة متعددة تخلق غابة مصغرة",
        "بونساي على طراز الرياح، تبدو وكأنها مشكلة بواسطة رياح قوية",
        "لقطة مقربة للحاء المحكم على شجرة بونساي صنوبر قديمة",
        "سيد بونساي يقوم بتقليم شجرة صغيرة بعناية باستخدام أدوات متخصصة",
        "شجرة بونساي كرز مزهرة بالكامل",
        "شجرة بونساي معروضة في كوة توكونوما يابانية تقليدية",
        "شجرة بونساي فيكس مع جذور هوائية مكشوفة تخلق طراز بانيان",
        "منظر طبيعي مصغر (سايكي) مع بونساي وصخور وطحلب",
        "بونساي على طراز الأدبي بجذع طويل ونحيف وأوراق متفرقة",
        "شجرة بونساي مغطاة بطبقة خفيفة من الثلج في الشتاء",
        "نبات اليشم المزروع كبونساي",
        "شجرة بونساي جهنمية بزهور ملونة تشبه الورق",
        "بونساي على طراز الجذر فوق الصخرة مع جذورها متمسكة بحجر",
        "مجموعة من أشجار بونساي مختلفة في بيئة حديقة هادئة",
        "لقطة مقربة للأوراق الصغيرة لشجرة بونساي البقس",
        "شجرة بونساي مع فواكه مصغرة، مثل شجرة تفاح أو حمضيات",
        "بونساي على الطراز العمودي الرسمي (شوكان) من الصنوبر",
        "بونساي على الطراز العمودي غير الرسمي (مويوغي) مع منحنيات لطيفة في الجذع",
        "بونساي على الطراز المائل (شاكان)، يميل إلى جانب واحد",
        "بونساي على طراز شبه الشلال (هان-كينغاي)",
        "بونساي على طراز المكنسة (هوكيداشي) من الزلكوفا",
        "زراعة جماعية (يوسي-أوه) من أشجار بونساي",
        "سقي شجرة بونساي بإبريق سقاية بفوهة دقيقة",
        "شجرة بونساي على حامل خشبي للعرض",
        "نظام الجذور المعقد (نيباري) لشجرة بونساي مزروعة جيداً",
        "شجرة بونساي عرعر مع ميزات الخشب الميت (جين وشاري)",
        "شجرة بونساي رمان مع ثمرة واحدة صغيرة",
        "شجرة بونساي وستاريا مع عناقيد زهور بنفسجية معلقة",
        "شجرة بونساي سيكويا في وعاء ضحل",
        "عملية إعادة زراعة شجرة بونساي",
        "عرض بسيط لشجرة بونساي واحدة في غرفة فارغة",
        "شجرة بونساي بجوار كوب صغير من الشاي",
        "ضوء الشمس يتسلل عبر أوراق شجرة بونساي دقيقة",
        "شجرة بونساي جنكة مع أوراقها الفريدة على شكل مروحة تتحول إلى اللون الأصفر",
        "بونساي على طراز الخشب الطافي، حيث تنمو الشجرة على قطعة من الخشب الطافي",
        "لقطة مقربة للتربة والطحلب في وعاء بونساي",
        "شجرة زيتون مزروعة كبونساي",
        "شجرة بونساي شوك النار مع توت أحمر ساطع",
        "شجرة بونساي كريب ميرتل مع لحاءها المميز وزهورها",
        "شجرة بونساي عرعر شيمباكو يتم تسليكها للتشكيل",
        "معرض بونساي مع العديد من الأشجار المعروضة",
        "بونساي مامي صغير، صغير بما يكفي ليحمل في يد واحدة",
        "شجرة بونساي على حافة نافذة، مظللة ضد الضوء",
        "شجرة بونساي منعكسة في بركة ماء ساكنة",
        "شجرة بونساي أرز مع أوراق متدلية",
        "شجرة باوباب مزروعة كبونساي"
    ],
    "الحلويات الفاخرة": [
        "شريحة من كعكة الحمم البركانية بالشوكولاتة الغنية مع مركز منصهر",
        "تيراميسو دقيق متعدد الطبقات مغطى بمسحوق الكاكاو",
        "تارت فواكه نابض بالحياة مع كيوي وفراولة وتوت أزرق على كريم باتيسير",
        "تشيز كيك نيويورك كلاسيكي مع قاعدة بسكويت جراهام وطبقة كرز",
        "طبق من ماكرون فرنسي ملون بنكهات مختلفة",
        "كريم بروليه مع طبقة سكر مكرملة تماماً",
        "كرة من جيلاتو الفستق الحلبي الحرفي في مخروط وافل",
        "كعكة الغابة السوداء الفاخرة مع طبقات من الشوكولاتة والكريمة والكرز",
        "كرامبل التفاح الدافئ مع كرة من آيس كريم الفانيليا",
        "ثلاثية من الحلويات المصغرة: تارتليت ليمون بالمرينغ، موس شوكولاتة، وباناكوتا",
        "أوبرا مبنية تماماً مع طبقات من إسفنج اللوز وشراب القهوة والغاناش",
        "شورت كيك الفراولة الخفيف والهوائي مع كريمة مخفوقة طازجة",
        "كومة من الفطائر الرقيقة مع شراب القيقب وقطعة من الزبدة",
        "كب كيك الكعكة الحمراء المزخرف بشكل جميل مع كريمة الجبن الكريمي",
        "شريحة من فطيرة الليم الرئيسية مع طبقة مرينغ محمصة",
        "كانولي إيطالي تقليدي محشو بجبن الريكوتا الحلو",
        "بسكويت رقائق الشوكولاتة الدافئ واللزج الطازج من الفرن",
        "كوب من بارفيه الحلوى الطبقات مع الفاكهة والزبادي والجرانولا",
        "تارت شوكولاتة داكنة وتوت متطورة",
        "كعكة بروفيترول أنيقة على شكل بجعة (شو أو كراكلان)",
        "طبق من تشوروس مع جانب من الشوكولاتة الساخنة السميكة للغمس",
        "شريحة من فطيرة البقان مع قشرة متقشرة",
        "كعكة قطرة المطر اليابانية، حلوى جيلاتينية شفافة",
        "كرة من سوربيه الليمون المنعش في كوب مبرد",
        "وافل بلجيكي مغطى بالسكر البودرة والفاكهة وصلصة الشوكولاتة",
        "ميلفوي دقيق (نابليون) مع طبقات من عجين الفطير والكريمة",
        "لفافة القرفة المخبوزة حديثاً مع التزيين المقطر في الأعلى",
        "وعاء من الفلان الإسباني مع صلصة الكراميل الغنية",
        "بودنغ التوفي اللزج الإنجليزي التقليدي مع صلصة التوفي",
        "كعكة حمم الماتشا الخضراء",
        "حلوى مفككة معروضة بطريقة فنية على طبق",
        "بومب ألاسكا، آيس كريم مغلف بالمرينغ ومشتعل",
        "شريحة من فطيرة اليقطين مع ملعقة من الكريمة المخفوقة",
        "كوب من أفوغاتو: كرة من آيس كريم الفانيليا مغمورة في إسبريسو ساخن",
        "بقلاوة تركية مع طبقات من العجين الرقيق والمكسرات والعسل",
        "تشيز كيك ياباني ملون ومتمايل",
        "حلوى الأرز اللزج بالمانجو من تايلاند",
        "باستيل دي ناتا البرتغالي (تارت البيض) مع سطح متقرح",
        "شريحة من كعكة الجزر مع كريمة الجبن الكريمي والجوز",
        "موس الشوكولاتة بالأفوكادو في كوب",
        "كرونات، الهجين بين الكرواسون والدونات، مع حشوة إبداعية",
        "طبق من سيرنيكي الروسي (فطائر الجبن) مع الكريمة الحامضة والمربى",
        "باناكوتا إيطالية مع كوليس التوت",
        "وعاء من إيتون ميس مع الفراولة والمرينغ والكريمة",
        "موز مجمد مغموس بالشوكولاتة مع رشات",
        "مادلين فرنسي كلاسيكي",
        "بودنغ الخبز الدافئ مع صلصة الويسكي",
        "شريحة من كعكة الملاك مع التوت الطازج",
        "تارت الشوكولاتة بالأفوكادو النباتية والخالية من الغلوتين",
        "موتشي الآيس كريم مقطوع من المنتصف لإظهار الحشوة"
    ],
    "الآلات الموسيقية": [
        "بيانو كبير على خشبة المسرح تحت الضوء الكاشف",
        "غيتار صوتي يستريح على مقعد في غرفة مريحة",
        "لقطة مقربة للأوتار وفتحات f للكمان",
        "ساكسفون نحاسي لامع يعكس أضواء نادي الجاز",
        "مجموعة طبول كاملة جاهزة لحفلة موسيقى الروك",
        "تشيلو خشبي جميل مسند على كرسي",
        "صف من الغيتارات الكهربائية الملونة معلقة على الحائط",
        "موسيقي يعزف على ناي فضي",
        "المفاتيح والأزرار المعقدة للكلارينيت",
        "أرغن أنابيب مهيب في كاتدرائية كبيرة",
        "مزمار اسكتلندي تقليدي يتم عزفه",
        "قيثارة بمنحنياتها الأنيقة والعديد من الأوتار",
        "بوق عتيق على قماش مخملي",
        "مجموعة من البونغو على شاطئ رملي",
        "كونترباس في زاوية استوديو موسيقي",
        "المفاتيح البيضاء والسوداء للوحة مفاتيح سنثيسايزر",
        "صنج واحد لامع على حامل",
        "ماريمبا خشبي مع قضبانه المتدرجة",
        "أكورديون يعزف عليه موسيقي شارع",
        "بانجو بجسمه المستدير المميز",
        "بوق فرنسي مع أنابيبه الملفوفة",
        "قطعة الفم والجرس من الترومبون",
        "ماندولين جميل مع طبقة لؤلؤة",
        "زوج من الماراكاس، مطلية بألوان زاهية",
        "كوتو ياباني تقليدي، آلة وترية طويلة",
        "سيتار هندي بعنقه الطويل والعديد من الأوتار",
        "مثلث، معلق بخيط، على وشك أن يُضرب",
        "ديدجريدو، آلة نفخ خشبية طويلة من أستراليا",
        "لوحة مفاتيح الهاربسيكورد",
        "مجموعة من طبول الصلب من الكاريبي",
        "غيتار باس كهربائي على حامل",
        "يوكيليلي بنمط زهري",
        "قصبات الهارمونيكا، لقطة مقربة",
        "مجموعة من طبول التيمباني في أوركسترا",
        "أوبوا جميل، مصنوع من خشب داكن",
        "كونسرتينا كبيرة، نوع من الأكورديون",
        "بيانو الإبهام (كاليمبا) يتم عزفه",
        "رف من آلات الإيقاع المختلفة: الدفوف، أجراس البقر، إلخ",
        "عود، آلة وترية من عصر النهضة",
        "دواسات البيانو الكبير، لقطة مقربة",
        "ثيرمين، آلة إلكترونية تُعزف دون ملامسة جسدية",
        "بالالايكا، آلة وترية روسية مثلثة",
        "هانغ درام، طبل فولاذي محدب يُعزف باليدين",
        "مجموعة من أجراس الرياح تهب بلطف في النسيم",
        "ميكروفون عتيق في استوديو تسجيل، مع آلة في الخلفية",
        "حامل نوتة موسيقية مع نوتة موسيقية، أمام آلة",
        "داخل البيانو، يظهر المطارق والأوتار",
        "هارمونيكا زجاجية، مع أوعيتها الزجاجية الدوارة",
        "لوحة خلط صوتي في استوديو تسجيل، مع آلات مرئية",
        "علبة كمان، مفتوحة لإظهار الآلة بالداخل"
    ],
    "أفق المدن ليلاً": [
        "أفق نيويورك المتلألئ ليلاً، يُرى من الجانب الآخر من النهر",
        "أفق شنغهاي المستقبلي مع برج اللؤلؤة الشرقية المضاء",
        "أفق لندن الأيقوني عند الغسق، مع جسر البرج المضاء",
        "أضواء المدينة الممتدة لطوكيو ليلاً من نقطة عالية",
        "أفق دبي الفريد ليلاً، يضم برج خليفة",
        "أفق باريس الرومانسي ليلاً، مع برج إيفل المتلألئ",
        "أفق هونغ كونغ النابض بالحياة ليلاً، مع عرض الأضواء الشهير",
        "أفق شيكاغو ليلاً، منعكس في بحيرة ميشيغان",
        "أفق سيدني ليلاً، مع دار الأوبرا وجسر الميناء",
        "أفق ساو باولو الملون والكثيف، البرازيل ليلاً",
        "أفق تورونتو ليلاً مع برج CN البارز",
        "أفق سياتل ليلاً، مع إبرة الفضاء المضاءة",
        "لقطة طويلة التعريض لأفق مدينة ليلاً، مع آثار ضوء من حركة المرور",
        "أفق سنغافورة الحديث ليلاً، مع مارينا باي ساندز",
        "أفق موسكو التاريخي ليلاً، مع الكرملين وكاتدرائية سانت باسيل",
        "منظر بانورامي لأفق لوس أنجلوس ليلاً، يمتد إلى الأفق",
        "أفق كوالالمبور ليلاً، مع برجي بتروناس",
        "عاصفة رعدية فوق أفق المدينة ليلاً",
        "انعكاس أفق المدينة في نهر هادئ ليلاً",
        "عرض ألعاب نارية فوق أفق المدينة ليلاً",
        "أفق لاس فيغاس ليلاً، عرض مبهر للأضواء",
        "منظر أفق المدينة ليلاً من نافذة طائرة",
        "أفق ضبابي ومضاء بالنيون لمدينة سايبربانك ليلاً",
        "القمر يشرق فوق أفق المدينة",
        "أفق مدينة ساحلية ليلاً، مع أضواء السفن في الميناء",
        "حفلة على السطح مع أفق المدينة ليلاً في الخلفية",
        "أفق تايبيه ليلاً، مع تايبيه 101",
        "صورة فاصلة زمنية للنجوم تتحرك فوق أفق المدينة",
        "منطقة الأعمال في مدينة كبرى ليلاً، مع إضاءة المكاتب",
        "أفق الدوحة، قطر، مع هندستها المعمارية الحديثة المضاءة ليلاً",
        "جسر يؤدي إلى مدينة بأفق جميل ليلاً",
        "أفق مدينة خلال 'الساعة الزرقاء' بعد الغروب مباشرة",
        "ليلة ضبابية في مدينة، مع أضواء الأفق مبعثرة بالضباب",
        "أفق ريو دي جانيرو ليلاً، مع تمثال المسيح الفادي",
        "لقطة مكبرة ومجردة لأضواء ونوافذ أفق المدينة ليلاً",
        "أفق مدينة في عاصفة ثلجية ليلاً",
        "شخص على شرفة ينظر إلى أفق مدينة شاسع ليلاً",
        "أفق فرانكفورت، ألمانيا، مع مجموعة ناطحات السحاب",
        "أفق مدينة ليلاً مع قمر كامل",
        "التباين بين جزء قديم وتاريخي من المدينة والأفق الحديث ليلاً",
        "أفق أتلانتا ليلاً، مع هندستها المعمارية المميزة",
        "أفق بانكوك ليلاً، مع مزيج من المعابد وناطحات السحاب",
        "منظر لأفق المدينة عبر نافذة مخططة بالمطر ليلاً",
        "أفق مدينة على شبه جزيرة، محاطة بالمياه والأضواء",
        "منطقة ضواحي هادئة مع توهج بعيد لأفق المدينة في الأفق",
        "أفق سيول ليلاً، مع برج N سيول على الجبل",
        "أفق مدينة ليلاً خلال مهرجان، مع فوانيس أو إضاءة خاصة",
        "انعكاس أفق المدينة المضاء بالنيون على شارع مبلل",
        "صورة مركبة لأفق المدينة مع مجرة أو سديم في السماء",
        "أفق مدينة مع معلم شهير، مثل بوابة القوس في سانت لويس، ليلاً"
    ],
    "الطيور الغريبة": [
        "ببغاء المكاو القرمزي بريشه الأحمر والأصفر والأزرق اللامع",
        "طاووس يعرض ريش ذيله المتقزح الرائع",
        "طوقان بمنقاره الكبير الملون، جاثم على غصن",
        "فلامنغو وردي يقف على رجل واحدة في مياه ضحلة",
        "طائر طنان يحوم في الهواء، يتغذى على رحيق زهرة",
        "نسر أصلع مهيب في الطيران، برأسه وذيله الأبيضين",
        "بومة ثلجية بعيونها الصفراء الساطعة، على خلفية شتوية",
        "عصفور ملون مطلي، طائر صغير بمزيج من الأزرق والأخضر والأصفر والأحمر",
        "طائر الرفراف يغوص في الماء للإمساك بسمكة",
        "طائر البفن الأطلسي بمنقاره الملون، واقف على منحدر",
        "حمامة فيكتوريا المتوجة، حمامة كبيرة زرقاء رمادية بتاج دانتيل",
        "طائر الكيتزال الغريب بريش ذيله الطويل والجميل",
        "طائر الجنة يؤدي رقصة المغازلة المعقدة",
        "طائر الأسطوانة ذو الصدر الليلكي، يعرض ألوانه العديدة في الطيران",
        "ببغاء المكاو الياقوتي، أكبر أنواع المكاو، بالأزرق العميق",
        "طائر أبو قرن العظيم بخوذته الكبيرة أعلى منقاره",
        "طائر السكرتير، طائر جارح أرضي كبير",
        "طائر أبو مركوب، بمنقاره الضخم على شكل حذاء",
        "عصفور غولديان ملون، بريشه النابض بالحياة",
        "كاسواري، طائر كبير لا يطير مع خوذة على رأسه",
        "ديك الصخور الأنديزي، طائر برتقالي ساطع من أمريكا الجنوبية",
        "كوكابورا من أستراليا، معروف بنداء ضحكته",
        "تدرج ذهبي، بقمته الذهبية الساطعة وجسمه الأحمر",
        "بط الماندرين، بريشه المزخرف والملون",
        "صقر الشاهين، أسرع حيوان في العالم، في الغوص",
        "هواتزين، طائر غريب بقمة ومظهر زاحف",
        "عريض المنقار ذو الذيل الطويل، طائر صغير أخضر ساطع من آسيا",
        "زرزور رائع، بريشه اللامع المتقزح",
        "أبو قرن وحيد القرن، بخوذته الكبيرة المنحنية",
        "تروغون رائع، مجموعة من الطيور الملونة من المناطق الاستوائية",
        "أبو خف أزرق القدمين، يؤدي رقصة المغازلة",
        "فرقاطة رائعة، بكيس حنجرته الأحمر القابل للنفخ الكبير",
        "بوتو، سيد التمويه، جاثم على جذع شجرة",
        "طائر طنان منقار السيف، بمنقار أطول من جسمه",
        "الكاكابو، ببغاء كبير ليلي لا يطير من نيوزيلندا",
        "نسر ملتحٍ، معروف بإسقاط العظام من ارتفاع",
        "ببغاء الشمس، ببغاء صغير ملون بألوان زاهية",
        "بط الخشب، بأنماطه وألوانه المعقدة",
        "موتموت، طائر بذيل طويل بأطراف على شكل مضرب",
        "أبو قرن ذو الخوذة، بخوذة صلبة تستخدم في القتال",
        "طائر التوراكو، مجموعة من الطيور الأفريقية الملونة",
        "طائر الجنة لويلسون، بريش ذيله الملفوف ورأسه الأزرق",
        "طائر الساتان باورربيرد، مع عريشته المزينة بأشياء زرقاء",
        "جاكانا، طائر يمكنه المشي على الغطاء النباتي العائم",
        "بومة الجحور، واقفة عند مدخل جحرها",
        "فروغماوث سريلانكا، سيد آخر للتمويه",
        "الهدهد، بتاجه المميز من الريش",
        "نسر الفلبين، طائر جارح كبير وقوي",
        "طائر الجنية الرائع، طائر صغير بريش أزرق لامع",
        "مجموعة من طيور البطريق أديلي في القارة القطبية الجنوبية"
    ],
    "الأنماط الهندسية المجردة": [
        "تبليط لأشكال سداسية متشابكة في نمط قرص العسل",
        "حلزوني من مربعات تسلسل فيبوناتشي، حلزوني ذهبي",
        "نمط فركتلي معقد، مثل مجموعة ماندلبروت، مع تفاصيل معقدة",
        "نمط متكرر من مثلثات ملونة، في تصميم سلس",
        "شبكة من دوائر متداخلة، تخلق نمط زهرة الحياة الهندسي",
        "نمط فن بصري بالأبيض والأسود مع خطوط متموجة تخلق وهم الحركة",
        "نمط مكعب ثلاثي الأبعاد، إسقاط متساوي القياس يخلق وهماً بصرياً",
        "نمط شعاعي من خطوط زاوية حادة تنبعث من نقطة مركزية",
        "تصميم متجه لأشكال هندسية مجردة بسيطة بألوان الباستيل",
        "نمط من دوائر متحدة المركز بألوان قوس قزح",
        "نمط فوضوي ومجرد من شظايا وخطوط هندسية عشوائية",
        "نمط سلس من بلاط زليج المغربي مع أشكال النجوم والصلبان",
        "نمط مستقبلي رقمي من شبكات وخطوط نيون مضيئة",
        "نمط بسيط وأنيق من خطوط متوازية بسمك ولون متغيرين",
        "تصميم نافذة زجاج ملون مع خطوط رصاص هندسية وزجاج ملون",
        "نمط آرت ديكو بأشكال هندسية جريئة ومتماثلة",
        "نمط كاليدوسكوبي، متماثل ومليء بالأشكال المتكررة",
        "نمط من مربعات ومستطيلات متشابكة، يذكر بعمل بيت موندريان",
        "خلفية متعددة الأضلاع منخفضة مع شبكة من المثلثات المتصلة",
        "نمط هندسي مستوحى من الفن الإسلامي، مع أنماط نجوم معقدة",
        "نمط من نقاط البولكا، مرتبة في شبكة مثالية",
        "نمط شيفرون بخطوط حادة متعرجة",
        "نمط مربعات أو ترتان، مع أشرطة أفقية وعمودية متقاطعة",
        "نمط أرجايل، بالألماس والخطوط المتقاطعة",
        "نمط هاوندستوث، نمط نسيج ثنائي اللون من الفحوصات المكسورة",
        "تبليط بنروز، تبليط غير دوري بشكلين",
        "نمط من أشكال الإطار السلكي ثلاثية الأبعاد، مثل المكعبات والكرات والأهرامات",
        "نمط تصميم ممفيس بأشكال هندسية مرحة وملونة",
        "نمط أشعة الشمس، مع أشعة تمتد من نقطة مركزية",
        "نمط موجات صوتية، ممثلة كخطوط هندسية",
        "رمز QR، نمط هندسي وظيفي",
        "نمط لوحة الدوائر، مع خطوطها ومكوناتها المعقدة",
        "نمط تصميم المفتاح اليوناني القديم (ميندر)",
        "نمط العقدة السلتية، مع حلقاتها المتشابكة اللانهائية",
        "تصميم مستوحى من الباوهاوس بأشكال هندسية بسيطة: دوائر، مربعات، مثلثات",
        "نمط من كرات مرتبة في هيكل شبكة بلورية",
        "تمثيل مجرد لخريطة مدينة، مع كتل وخطوط هندسية",
        "نمط من مربعات متداخلة مع شفافية مختلفة",
        "نمط هندسي مصنوع من الورق المقطوع، مع ظلال تخلق عمقاً",
        "نمط من أشكال الماس المشعة",
        "خلفية بسيطة مع شكل هندسي واحد كبير",
        "نمط من أشكال إيشر المستحيلة",
        "نمط نصف نغمي، بنقاط ذات حجم متغير تخلق صورة",
        "نمط من أشرطة أو نطاقات ملونة متقاطعة",
        "تصميم قائم على النسبة الذهبية، مع نسب متناسقة",
        "مخطط فورونوي، نمط من خلايا حول نقاط",
        "نمط هندسي يبدو أنه يتراجع نحو نقطة التلاشي",
        "نمط من مثلثات تشكل فركتل مثلث سيربنسكي",
        "نمط مخطط بسيط، بخطوط عمودية أو أفقية",
        "نمط رقعة شطرنج، بمربعات سوداء وبيضاء متناوبة"
    ]
}

def main():
    """
    الوظيفة الرئيسية لتوليد وتنظيم مجموعة البيانات.
    """
    # --- الخطوة 1: تهيئة النموذج ---
    print("تحميل نموذج Stable Diffusion...")
    device = "cuda" if torch.cuda.is_available() else "cpu"
    pipe = StableDiffusionPipeline.from_pretrained(MODEL_ID, torch_dtype=torch.float16)
    pipe = pipe.to(device)
    print(f"تم تحميل النموذج بنجاح على {device}.")

    # --- الخطوة 2: إنشاء الدلائل وتوليد البيانات ---
    print(f"إنشاء الدليل الرئيسي: {OUTPUT_DIR}")
    os.makedirs(OUTPUT_DIR, exist_ok=True)

    # التكرار عبر المنهج بالترتيب المحدد
    for i, concept_name in enumerate(CURRICULUM_ORDER):
        # تنسيق اسم المفهوم للدليل
        concept_dir_name = f"{i+1:02d}_{concept_name.lower().replace(' ', '_')}"
        concept_path = os.path.join(OUTPUT_DIR, concept_dir_name)
        os.makedirs(concept_path, exist_ok=True)
        
        print(f"\n--- معالجة المفهوم {i+1}/{len(CURRICULUM_ORDER)}: {concept_name} ---")
        print(f"الحفظ في: {concept_path}")

        metadata_path = os.path.join(concept_path, "metadata.jsonl")
        
        with open(metadata_path, 'w', encoding='utf-8') as metadata_file:
            prompts_for_concept = PROMPTS.get(concept_name, [])
            if not prompts_for_concept:
                print(f"  تحذير: لم يتم العثور على موجهات للمفهوم '{concept_name}'. تخطي.")
                continue
            
            for j, prompt in enumerate(prompts_for_concept):
                print(f"  توليد الصورة {j+1}/{len(prompts_for_concept)} للموجه: '{prompt[:50]}...'")

                try:
                    # توليد الصورة
                    image = pipe(
                        prompt, 
                        negative_prompt=NEGATIVE_PROMPT, 
                        num_inference_steps=50, 
                        guidance_scale=7.5
                    ).images[0]

                    # تحديد اسم ملف الصورة وحفظها
                    image_filename = f"image_{j:03d}.png"
                    image_path = os.path.join(concept_path, image_filename)
                    image.save(image_path)

                    # إنشاء إدخال البيانات الوصفية والكتابة إلى الملف
                    metadata_entry = {
                        "file_name": image_filename,
                        "prompt": prompt
                    }
                    metadata_file.write(json.dumps(metadata_entry, ensure_ascii=False) + "\n")

                except Exception as e:
                    print(f"  خطأ في توليد الصورة للموجه '{prompt}': {e}")


    print("\n✅ اكتمل توليد وتنظيم مجموعة البيانات الآمنة!")
    print(f"مجموعة بيانات الضبط الدقيق جاهزة في: {OUTPUT_DIR}")

if __name__ == "__main__":
    main()